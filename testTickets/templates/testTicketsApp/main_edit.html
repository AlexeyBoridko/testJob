{% extends "base.html" %}
{% block title %}<title>My contact info</title>{% endblock %}

{% block header %}
    {% load staticfiles %}
    {{ my_info.media }}
{% endblock %}

{% block h1 %}42 Coffee Cups Test Assignment{% endblock %}
{% block login_logout %}
    {% if user.is_authenticated %}
        Welcome, {{ user.username }} <a href="{% url 'logout' %}">Logout</a>
    {% endif %}
{% endblock %}
{% block content %}
     <script type="text/javascript">
        $(document).ready(function(){
{#            $("#submit_status").text("");#}
{#            $('#progress').hide();#}

            function showProgress() {
                $("form input, form textarea").prop('disabled', 'disabled');
                $('#progress').show();
            }

            function ajaxSuccess(){
                $("form input, form textarea").removeProp('disabled');
                $("#submit_status").text("Changes have been saved");
                $('#progress').hide();
            }

            function ajaxError(){
                $("#submit_status").text("Update error");
            }

            var options = {
                target: $('body'),
                beforeSubmit: showProgress,
                success: ajaxSuccess,
                error:ajaxError
            };

            $('#formid').submit(function() {
                $(this).ajaxSubmit(options);
                return false;
            });
        });
    </script>


    <div id="progress" class="progress">
        <img  src="{% static "img/progress.gif" %}" alt="Progress..." />
    </div>

    <form id="formid" enctype="multipart/form-data" method="post" action="" >
    {% csrf_token %}
        <div class="partcontainer">
            <div class="leftpart">
                <div class="field">
                    {{ my_info.name.label_tag }}
                    {{ my_info.name }}
                    <span class="error">{{ my_info.name.errors }}</span>
                </div>
                <div class="field">
                    {{ my_info.surname.label_tag }}
                    {{ my_info.surname }}
                    <span class="error">{{ my_info.surname.errors }}</span>
                </div>
                <div class="field">
                    {{ my_info.date_of_birth.label_tag}}
                    {{ my_info.date_of_birth}}
                    <span class="error">{{ my_info.date_of_birth.errors }}</span>
                </div>
                <div class="field">
                    {{ my_info.photo.label_tag}}
                    {{ my_info.photo}}
                </div>
                <div class="field">
                    <label></label>
                    {% if userInfo.photo%}
                        <img src="{{ userInfo.photo.url }}" alt="My uploaded photo" width="250px" height="330px" border="1px">
                    {% else %}
                        <div class="no-photo">Photo was not uploaded yet</div>
                    {% endif %}
                </div>
            </div>
            <div class="rightpart">
                <div class="field">
                    {{ my_info.contacts.label_tag}}
                    {{ my_info.contacts }}
                    <span class="error">{{ my_info.contacts.errors }}</span>
                </div>
                <div class="field">
                    {{ my_info.email.label_tag}}
                    {{ my_info.email }}
                    <span class="error">{{ my_info.email.errors }}</span>
                </div>
                 <div class="field">
                    {{ my_info.jid.label_tag }}
                    {{ my_info.jid }}
                    <span class="error">{{ my_info.jid.errors }}</span>
                </div>
                <div class="field">
                    {{ my_info.skype_id.label_tag }}
                    {{ my_info.skype_id }}
                    <span class="error">{{ my_info.skype_id.errors }}</span>
                </div>
                <div class="field-multiline">
                    {{ my_info.other_contacts.label_tag }}
                    {{ my_info.other_contacts}}
                    <span class="error">{{ my_info.other_contacts.errors }}</span>
                </div>
                <div class="field-multiline">
                    {{ my_info.bio.label_tag}}
                    {{ my_info.bio}}
                    <span class="error">{{ my_info.bio.errors }}</span>
                </div>
            </div>
        </div>
        <div class="buttons-block-bottom">
           <div>
               {% if my_info.errors %}
                   <label>Update was canceled. Please verify data</label>
               {% else %}
                   <label id="submit_status"></label>
               {% endif %}
           </div>
           <input type="submit" value="Save"/>
           <a href="{% url 'main' %}">Cancel</a>
        </div>
    </form>
    <hr>
    <div class="partcontainer">
        <a href="{% url 'requests' %}">requests</a>
    </div>
{% endblock %}